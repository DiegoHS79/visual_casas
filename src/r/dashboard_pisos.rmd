---
title: "Estado de la vivienda en Alicante"
# date: "`r Sys.Date()`"
output: 
  flexdashboard::flex_dashboard:
    # orientation vale para los encabezados de segundo nivel en adelante.
    # orientation: Columns
    vertical_layout: fill
    css: css_rules.css

runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(reactable)
library(tidyverse)
library(latex2exp)
library(dygraphs)
library(ggplot2)
library(xts)
library(stringr)
library(htmltools)
library(stringr)
library(rjson)
```

# Estadísticas por Distritos/Barrios

```{r}

```

# Benalua - La Florida - San Gabriel {data-navmenu="Evolución IPV y Predicción"}

## Cuadro de control {.sidebar}

```{r}
benalua_data <- read.csv("data_temporal/benalua_la_florida_babel_san_gabriel.csv", header=TRUE, sep="\t")
benalua_data <- data.frame(benalua_data)
benalua_data[is.na(benalua_data)] <- 0.0
benalua_data$Mes = as.POSIXct(benalua_data$Mes, format = "%Y-%m-%d", tz="UTC")

# Shiny
checkboxGroupInput(
  inputId = "checkGroup", 
  label = h3("Selecciona la columna"), 
  choiceNames = list("Precio [m2]", "Variación Mensual", "Variación Trimestral", "Variación Anual"),
  choiceValues = names(benalua_data)[-1],
  selected = c("Precio.m2")
)
```
Column {.tabset .tabset-fade}
---
### **Evolución Temporal**
```{r}
# crear archivo xts
stat_xts <- xts(benalua_data, order.by=benalua_data$Mes)

renderDygraph({
  stat_xts <- stat_xts[, c("Mes", input$checkGroup)]
  
  graph <- dygraph(stat_xts) %>%
    dyLegend(show = "onmouseover", labelsSeparateLines = TRUE) %>%
    dyAxis("x", valueRange = c("01/01/2008", "01/12/2023"), label = "Año", drawGrid = TRUE) %>%
    dyAxis("y", label = "Precio por metro cuadrado [m2]") %>%
    dyAxis("y2", label = "Variación porcentual [%]", independentTicks = c(TRUE, TRUE), valueRange = c(-17, 22)) %>%
    dyRangeSelector(dateWindow = c("2009-06-01", "2023-12-01")) %>%
    dyHighlight(highlightCircleSize = 5,
                highlightSeriesOpts = list(strokeWidth = 1.5),
                highlightSeriesBackgroundAlpha = 0.2,
                hideOnMouseOut = TRUE) %>%
    {
      if(length(str_subset(input$checkGroup, 'Precio.m2$')) > 0 )
        dySeries(., "Precio.m2", label = "Precio [m2]")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup, 'Variación.mensual$')) > 0 )
        dySeries(., "Variación.mensual", axis = 'y2', label = "Variación Mensual")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup, 'Variación.trimestral$')) > 0 )
        dySeries(., "Variación.trimestral", axis = 'y2', label = "Variación Trimestral")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup, 'Variación.anual$')) > 0 )
        dySeries(., "Variación.anual", axis = 'y2', label = "Variación Anual")
      else
        .
    }
})
```

### **Predicción con Modeltime**
esto es una prueba

Column {data-width=250}
---
### **Datos de la Tabla**
```{r}
reactable(benalua_data, 
          filterable = TRUE,
          columns = list(
              Mes = colDef(name = "Fecha", format = colFormat(date = TRUE, locales = "pt-BR")),
              Precio.m2 = colDef(name = "Precio\n [m2]"),
              Variación.mensual = colDef(
                name = "Variación\n Mensual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.trimestral = colDef(
                name = "Variación\n Trimestral",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.anual = colDef(
                name = "Variación\n Anual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              )
          )
)
```


# Campoamor - Carolinas - Altozano {data-navmenu="Evolución IPV y Predicción"}

## Cuadro de control {.sidebar}

```{r}
campoamor_data <- read.csv("data_temporal/campoamor_carolinas_altozano.csv", header=TRUE, sep="\t")
campoamor_data <- data.frame(campoamor_data)
campoamor_data[is.na(campoamor_data)] <- 0.0
campoamor_data$Mes = as.POSIXct(campoamor_data$Mes, format = "%Y-%m-%d", tz="UTC")

# Shiny
checkboxGroupInput(
  inputId = "checkGroup_c", 
  label = h3("Selecciona la columna"), 
  choiceNames = list("Precio [m2]", "Variación Mensual", "Variación Trimestral", "Variación Anual"),
  choiceValues = names(campoamor_data)[-1],
  selected = c("Precio.m2")
)
```
Column {.tabset .tabset-fade}
---
### **Evolución Temporal**
```{r}
# crear archivo xts
stat_xts_c <- xts(campoamor_data, order.by=campoamor_data$Mes)

renderDygraph({
  stat_xts_c <- stat_xts_c[, c("Mes", input$checkGroup_c)]
  
  graph_c <- dygraph(stat_xts_c) %>%
    dyLegend(show = "onmouseover", labelsSeparateLines = TRUE) %>%
    dyAxis("x", valueRange = c("01/01/2008", "01/12/2023"), label = "Año", drawGrid = TRUE) %>%
    dyAxis("y", label = "Precio por metro cuadrado [m2]") %>%
    dyAxis("y2", label = "Variación porcentual [%]", independentTicks = c(TRUE, TRUE), valueRange = c(-19.5, 23)) %>%
    dyRangeSelector(dateWindow = c("2009-06-01", "2023-12-01")) %>%
    dyHighlight(highlightCircleSize = 5,
                highlightSeriesOpts = list(strokeWidth = 1.5),
                highlightSeriesBackgroundAlpha = 0.2,
                hideOnMouseOut = TRUE) %>%
    {
      if(length(str_subset(input$checkGroup_c, 'Precio.m2$')) > 0 )
        dySeries(., "Precio.m2", label = "Precio [m2]")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_c, 'Variación.mensual$')) > 0 )
        dySeries(., "Variación.mensual", axis = 'y2', label = "Variación Mensual")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_c, 'Variación.trimestral$')) > 0 )
        dySeries(., "Variación.trimestral", axis = 'y2', label = "Variación Trimestral")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_c, 'Variación.anual$')) > 0 )
        dySeries(., "Variación.anual", axis = 'y2', label = "Variación Anual")
      else
        .
    }
})
```

### **Predicción con Modeltime**
esto es una prueba

Column {data-width=250}
---
### **Datos de la Tabla**
```{r}
reactable(campoamor_data, 
          filterable = TRUE,
          columns = list(
              Mes = colDef(name = "Fecha", format = colFormat(date = TRUE, locales = "pt-BR")),
              Precio.m2 = colDef(name = "Precio\n [m2]"),
              Variación.mensual = colDef(
                name = "Variación\n Mensual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.trimestral = colDef(
                name = "Variación\n Trimestral",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.anual = colDef(
                name = "Variación\n Anual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              )
          )
)
```


# Zona Centro {data-navmenu="Evolución IPV y Predicción"}

## Cuadro de control {.sidebar}

```{r}
centro_data <- read.csv("data_temporal/centro.csv", header=TRUE, sep="\t")
centro_data <- data.frame(centro_data)
centro_data[is.na(centro_data)] <- 0.0
centro_data$Mes = as.POSIXct(centro_data$Mes, format = "%Y-%m-%d", tz="UTC")

# Shiny
checkboxGroupInput(
  inputId = "checkGroup_c2", 
  label = h3("Selecciona la columna"), 
  choiceNames = list("Precio [m2]", "Variación Mensual", "Variación Trimestral", "Variación Anual"),
  choiceValues = names(centro_data)[-1],
  selected = c("Precio.m2")
)
```
Column {.tabset .tabset-fade}
---
### **Evolución Temporal**
```{r}
# crear archivo xts
stat_xts_c2 <- xts(centro_data, order.by=centro_data$Mes)

renderDygraph({
  stat_xts_c2 <- stat_xts_c2[, c("Mes", input$checkGroup_c2)]
  
  graph_c2 <- dygraph(stat_xts_c2) %>%
    dyLegend(show = "onmouseover", labelsSeparateLines = TRUE) %>%
    dyAxis("x", valueRange = c("01/01/2008", "01/12/2023"), label = "Año", drawGrid = TRUE) %>%
    dyAxis("y", label = "Precio por metro cuadrado [m2]") %>%
    dyAxis("y2", label = "Variación porcentual [%]", independentTicks = c(TRUE, TRUE), valueRange = c(-17, 22)) %>%
    dyRangeSelector(dateWindow = c("2009-06-01", "2023-12-01")) %>%
    dyHighlight(highlightCircleSize = 5,
                highlightSeriesOpts = list(strokeWidth = 1.5),
                highlightSeriesBackgroundAlpha = 0.2,
                hideOnMouseOut = TRUE) %>%
    {
      if(length(str_subset(input$checkGroup_c2, 'Precio.m2$')) > 0 )
        dySeries(., "Precio.m2", label = "Precio [m2]")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_c2, 'Variación.mensual$')) > 0 )
        dySeries(., "Variación.mensual", axis = 'y2', label = "Variación Mensual")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_c2, 'Variación.trimestral$')) > 0 )
        dySeries(., "Variación.trimestral", axis = 'y2', label = "Variación Trimestral")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_c2, 'Variación.anual$')) > 0 )
        dySeries(., "Variación.anual", axis = 'y2', label = "Variación Anual")
      else
        .
    }
})
```

### **Predicción con Modeltime**
esto es una prueba

Column {data-width=250}
---
### **Datos de la Tabla**
```{r}
reactable(centro_data, 
          filterable = TRUE,
          columns = list(
              Mes = colDef(name = "Fecha", format = colFormat(date = TRUE, locales = "pt-BR")),
              Precio.m2 = colDef(name = "Precio\n [m2]"),
              Variación.mensual = colDef(
                name = "Variación\n Mensual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.trimestral = colDef(
                name = "Variación\n Trimestral",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.anual = colDef(
                name = "Variación\n Anual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              )
          )
)
```


# Los Ángeles - Tombola - San Nicolás {data-navmenu="Evolución IPV y Predicción"}

## Cuadro de control {.sidebar}

```{r}
angeles_data <- read.csv("data_temporal/los_angeles_tombola_san_nicolas.csv", header=TRUE, sep="\t")
angeles_data <- data.frame(angeles_data)
angeles_data[is.na(angeles_data)] <- 0.0
angeles_data$Mes = as.POSIXct(angeles_data$Mes, format = "%Y-%m-%d", tz="UTC")

# Shiny
checkboxGroupInput(
  inputId = "checkGroup_a", 
  label = h3("Selecciona la columna"), 
  choiceNames = list("Precio [m2]", "Variación Mensual", "Variación Trimestral", "Variación Anual"),
  choiceValues = names(angeles_data)[-1],
  selected = c("Precio.m2")
)
```
Column {.tabset .tabset-fade}
---
### **Evolución Temporal**
```{r}
# crear archivo xts
stat_xts_a <- xts(angeles_data, order.by=angeles_data$Mes)

renderDygraph({
  stat_xts_a <- stat_xts_a[, c("Mes", input$checkGroup_a)]
  
  graph_a <- dygraph(stat_xts_a) %>%
    dyLegend(show = "onmouseover", labelsSeparateLines = TRUE) %>%
    dyAxis("x", valueRange = c("01/01/2008", "01/12/2023"), label = "Año", drawGrid = TRUE) %>%
    dyAxis("y", label = "Precio por metro cuadrado [m2]") %>%
    dyAxis("y2", label = "Variación porcentual [%]", independentTicks = c(TRUE, TRUE), valueRange = c(-34, 26)) %>%
    dyRangeSelector(dateWindow = c("2009-06-01", "2023-12-01")) %>%
    dyHighlight(highlightCircleSize = 5,
                highlightSeriesOpts = list(strokeWidth = 1.5),
                highlightSeriesBackgroundAlpha = 0.2,
                hideOnMouseOut = TRUE) %>%
    {
      if(length(str_subset(input$checkGroup_a, 'Precio.m2$')) > 0 )
        dySeries(., "Precio.m2", label = "Precio [m2]")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_a, 'Variación.mensual$')) > 0 )
        dySeries(., "Variación.mensual", axis = 'y2', label = "Variación Mensual")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_a, 'Variación.trimestral$')) > 0 )
        dySeries(., "Variación.trimestral", axis = 'y2', label = "Variación Trimestral")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_a, 'Variación.anual$')) > 0 )
        dySeries(., "Variación.anual", axis = 'y2', label = "Variación Anual")
      else
        .
    }
})
```

### **Predicción con Modeltime**
esto es una prueba

Column {data-width=250}
---
### **Datos de la Tabla**
```{r}
reactable(angeles_data, 
          filterable = TRUE,
          columns = list(
              Mes = colDef(name = "Fecha", format = colFormat(date = TRUE, locales = "pt-BR")),
              Precio.m2 = colDef(name = "Precio\n [m2]"),
              Variación.mensual = colDef(
                name = "Variación\n Mensual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.trimestral = colDef(
                name = "Variación\n Trimestral",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.anual = colDef(
                name = "Variación\n Anual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              )
          )
)
```


# Parque Avenidas - Vistahermosa {data-navmenu="Evolución IPV y Predicción"}

## Cuadro de control {.sidebar}

```{r}
vistahermosa_data <- read.csv("data_temporal/parque_avenidas_vistahermosa.csv", header=TRUE, sep="\t")
vistahermosa_data <- data.frame(vistahermosa_data)
vistahermosa_data[is.na(vistahermosa_data)] <- 0.0
vistahermosa_data$Mes = as.POSIXct(vistahermosa_data$Mes, format = "%Y-%m-%d", tz="UTC")

# Shiny
checkboxGroupInput(
  inputId = "checkGroup_v", 
  label = h3("Selecciona la columna"), 
  choiceNames = list("Precio [m2]", "Variación Mensual", "Variación Trimestral", "Variación Anual"),
  choiceValues = names(vistahermosa_data)[-1],
  selected = c("Precio.m2")
)
```
Column {.tabset .tabset-fade}
---
### **Evolución Temporal**
```{r}
# crear archivo xts
stat_xts_v <- xts(vistahermosa_data, order.by=vistahermosa_data$Mes)

renderDygraph({
  stat_xts_v <- stat_xts_v[, c("Mes", input$checkGroup_v)]
  
  graph_v <- dygraph(stat_xts_v) %>%
    dyLegend(show = "onmouseover", labelsSeparateLines = TRUE) %>%
    dyAxis("x", valueRange = c("01/01/2008", "01/12/2023"), label = "Año", drawGrid = TRUE) %>%
    dyAxis("y", label = "Precio por metro cuadrado [m2]") %>%
    dyAxis("y2", label = "Variación porcentual [%]", independentTicks = c(TRUE, TRUE), valueRange = c(-17, 25)) %>%
    dyRangeSelector(dateWindow = c("2009-06-01", "2023-12-01")) %>%
    dyHighlight(highlightCircleSize = 5,
                highlightSeriesOpts = list(strokeWidth = 1.5),
                highlightSeriesBackgroundAlpha = 0.2,
                hideOnMouseOut = TRUE) %>%
    {
      if(length(str_subset(input$checkGroup_v, 'Precio.m2$')) > 0 )
        dySeries(., "Precio.m2", label = "Precio [m2]")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_v, 'Variación.mensual$')) > 0 )
        dySeries(., "Variación.mensual", axis = 'y2', label = "Variación Mensual")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_v, 'Variación.trimestral$')) > 0 )
        dySeries(., "Variación.trimestral", axis = 'y2', label = "Variación Trimestral")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_v, 'Variación.anual$')) > 0 )
        dySeries(., "Variación.anual", axis = 'y2', label = "Variación Anual")
      else
        .
    }
})
```

### **Predicción con Modeltime**
esto es una prueba

Column {data-width=250}
---
### **Datos de la Tabla**
```{r}
reactable(vistahermosa_data, 
          filterable = TRUE,
          columns = list(
              Mes = colDef(name = "Fecha", format = colFormat(date = TRUE, locales = "pt-BR")),
              Precio.m2 = colDef(name = "Precio\n [m2]"),
              Variación.mensual = colDef(
                name = "Variación\n Mensual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.trimestral = colDef(
                name = "Variación\n Trimestral",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.anual = colDef(
                name = "Variación\n Anual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              )
          )
)
```


# Pla del Bon Repos - La Goleta - San Anton {data-navmenu="Evolución IPV y Predicción"}

## Cuadro de control {.sidebar}

```{r}
goleta_data <- read.csv("data_temporal/pla_del_bon_repos_la_goleta_san_anton.csv", header=TRUE, sep="\t")
goleta_data <- data.frame(goleta_data)
goleta_data[is.na(goleta_data)] <- 0.0
goleta_data$Mes = as.POSIXct(goleta_data$Mes, format = "%Y-%m-%d", tz="UTC")

# Shiny
checkboxGroupInput(
  inputId = "checkGroup_g", 
  label = h3("Selecciona la columna"), 
  choiceNames = list("Precio [m2]", "Variación Mensual", "Variación Trimestral", "Variación Anual"),
  choiceValues = names(goleta_data)[-1],
  selected = c("Precio.m2")
)
```
Column {.tabset .tabset-fade}
---
### **Evolución Temporal**
```{r}
# crear archivo xts
stat_xts_g <- xts(goleta_data, order.by=goleta_data$Mes)

renderDygraph({
  stat_xts_g <- stat_xts_g[, c("Mes", input$checkGroup_g)]
  
  graph_g <- dygraph(stat_xts_g) %>%
    dyLegend(show = "onmouseover", labelsSeparateLines = TRUE) %>%
    dyAxis("x", valueRange = c("01/01/2008", "01/12/2023"), label = "Año", drawGrid = TRUE) %>%
    dyAxis("y", label = "Precio por metro cuadrado [m2]") %>%
    dyAxis("y2", label = "Variación porcentual [%]", independentTicks = c(TRUE, TRUE), valueRange = c(-17, 25.5)) %>%
    dyRangeSelector(dateWindow = c("2009-06-01", "2023-12-01")) %>%
    dyHighlight(highlightCircleSize = 5,
                highlightSeriesOpts = list(strokeWidth = 1.5),
                highlightSeriesBackgroundAlpha = 0.2,
                hideOnMouseOut = TRUE) %>%
    {
      if(length(str_subset(input$checkGroup_g, 'Precio.m2$')) > 0 )
        dySeries(., "Precio.m2", label = "Precio [m2]")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_g, 'Variación.mensual$')) > 0 )
        dySeries(., "Variación.mensual", axis = 'y2', label = "Variación Mensual")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_g, 'Variación.trimestral$')) > 0 )
        dySeries(., "Variación.trimestral", axis = 'y2', label = "Variación Trimestral")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_g, 'Variación.anual$')) > 0 )
        dySeries(., "Variación.anual", axis = 'y2', label = "Variación Anual")
      else
        .
    }
})
```

### **Predicción con Modeltime**
esto es una prueba

Column {data-width=250}
---
### **Datos de la Tabla**
```{r}
reactable(goleta_data, 
          filterable = TRUE,
          columns = list(
              Mes = colDef(name = "Fecha", format = colFormat(date = TRUE, locales = "pt-BR")),
              Precio.m2 = colDef(name = "Precio\n [m2]"),
              Variación.mensual = colDef(
                name = "Variación\n Mensual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.trimestral = colDef(
                name = "Variación\n Trimestral",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.anual = colDef(
                name = "Variación\n Anual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              )
          )
)
```


# Playa de San Juan - El Cabo {data-navmenu="Evolución IPV y Predicción"}

## Cuadro de control {.sidebar}

```{r}
sanjuan_data <- read.csv("data_temporal/playa_de_san_juan_el_cabo.csv", header=TRUE, sep="\t")
sanjuan_data <- data.frame(sanjuan_data)
sanjuan_data[is.na(sanjuan_data)] <- 0.0
sanjuan_data$Mes = as.POSIXct(sanjuan_data$Mes, format = "%Y-%m-%d", tz="UTC")

# Shiny
checkboxGroupInput(
  inputId = "checkGroup_s", 
  label = h3("Selecciona la columna"), 
  choiceNames = list("Precio [m2]", "Variación Mensual", "Variación Trimestral", "Variación Anual"),
  choiceValues = names(sanjuan_data)[-1],
  selected = c("Precio.m2")
)
```
Column {.tabset .tabset-fade}
---
### **Evolución Temporal**
```{r}
# crear archivo xts
stat_xts_s <- xts(sanjuan_data, order.by=sanjuan_data$Mes)

renderDygraph({
  stat_xts_s <- stat_xts_s[, c("Mes", input$checkGroup_s)]
  
  graph_s <- dygraph(stat_xts_s) %>%
    dyLegend(show = "onmouseover", labelsSeparateLines = TRUE) %>%
    dyAxis("x", valueRange = c("01/01/2008", "01/12/2023"), label = "Año", drawGrid = TRUE) %>%
    dyAxis("y", label = "Precio por metro cuadrado [m2]") %>%
    dyAxis("y2", label = "Variación porcentual [%]", independentTicks = c(TRUE, TRUE), valueRange = c(-17, 25.5)) %>%
    dyRangeSelector(dateWindow = c("2009-06-01", "2023-12-01")) %>%
    dyHighlight(highlightCircleSize = 5,
                highlightSeriesOpts = list(strokeWidth = 1.5),
                highlightSeriesBackgroundAlpha = 0.2,
                hideOnMouseOut = TRUE) %>%
    {
      if(length(str_subset(input$checkGroup_s, 'Precio.m2$')) > 0 )
        dySeries(., "Precio.m2", label = "Precio [m2]")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_s, 'Variación.mensual$')) > 0 )
        dySeries(., "Variación.mensual", axis = 'y2', label = "Variación Mensual")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_s, 'Variación.trimestral$')) > 0 )
        dySeries(., "Variación.trimestral", axis = 'y2', label = "Variación Trimestral")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_s, 'Variación.anual$')) > 0 )
        dySeries(., "Variación.anual", axis = 'y2', label = "Variación Anual")
      else
        .
    }
})
```

### **Predicción con Modeltime**
esto es una prueba

Column {data-width=250}
---
### **Datos de la Tabla**
```{r}
reactable(sanjuan_data, 
          filterable = TRUE,
          columns = list(
              Mes = colDef(name = "Fecha", format = colFormat(date = TRUE, locales = "pt-BR")),
              Precio.m2 = colDef(name = "Precio\n [m2]"),
              Variación.mensual = colDef(
                name = "Variación\n Mensual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.trimestral = colDef(
                name = "Variación\n Trimestral",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.anual = colDef(
                name = "Variación\n Anual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              )
          )
)
```


# San Blas - Pau {data-navmenu="Evolución IPV y Predicción"}

## Cuadro de control {.sidebar}

```{r}
sanblas_data <- read.csv("data_temporal/san_blas_pau.csv", header=TRUE, sep="\t")
sanblas_data <- data.frame(sanblas_data)
sanblas_data[is.na(sanblas_data)] <- 0.0
sanblas_data$Mes = as.POSIXct(sanblas_data$Mes, format = "%Y-%m-%d", tz="UTC")

# Shiny
checkboxGroupInput(
  inputId = "checkGroup_s2", 
  label = h3("Selecciona la columna"), 
  choiceNames = list("Precio [m2]", "Variación Mensual", "Variación Trimestral", "Variación Anual"),
  choiceValues = names(sanblas_data)[-1],
  selected = c("Precio.m2")
)
```
Column {.tabset .tabset-fade}
---
### **Evolución Temporal**
```{r}
# crear archivo xts
stat_xts_s2 <- xts(sanblas_data, order.by=sanblas_data$Mes)

renderDygraph({
  stat_xts_s2 <- stat_xts_s2[, c("Mes", input$checkGroup_s2)]
  
  graph_s2 <- dygraph(stat_xts_s2) %>%
    dyLegend(show = "onmouseover", labelsSeparateLines = TRUE) %>%
    dyAxis("x", valueRange = c("01/01/2008", "01/12/2023"), label = "Año", drawGrid = TRUE) %>%
    dyAxis("y", label = "Precio por metro cuadrado [m2]") %>%
    dyAxis("y2", label = "Variación porcentual [%]", independentTicks = c(TRUE, TRUE), valueRange = c(-17, 22)) %>%
    dyRangeSelector(dateWindow = c("2009-06-01", "2023-12-01")) %>%
    dyHighlight(highlightCircleSize = 5,
                highlightSeriesOpts = list(strokeWidth = 1.5),
                highlightSeriesBackgroundAlpha = 0.2,
                hideOnMouseOut = TRUE) %>%
    {
      if(length(str_subset(input$checkGroup_s2, 'Precio.m2$')) > 0 )
        dySeries(., "Precio.m2", label = "Precio [m2]")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_s2, 'Variación.mensual$')) > 0 )
        dySeries(., "Variación.mensual", axis = 'y2', label = "Variación Mensual")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_s2, 'Variación.trimestral$')) > 0 )
        dySeries(., "Variación.trimestral", axis = 'y2', label = "Variación Trimestral")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_s2, 'Variación.anual$')) > 0 )
        dySeries(., "Variación.anual", axis = 'y2', label = "Variación Anual")
      else
        .
    }
})
```

### **Predicción con Modeltime**
esto es una prueba

Column {data-width=250}
---
### **Datos de la Tabla**
```{r}
reactable(sanblas_data, 
          filterable = TRUE,
          columns = list(
              Mes = colDef(name = "Fecha", format = colFormat(date = TRUE, locales = "pt-BR")),
              Precio.m2 = colDef(name = "Precio\n [m2]"),
              Variación.mensual = colDef(
                name = "Variación\n Mensual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.trimestral = colDef(
                name = "Variación\n Trimestral",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.anual = colDef(
                name = "Variación\n Anual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              )
          )
)
```


# Villafranqueza - Santa Faz - Monegre {data-navmenu="Evolución IPV y Predicción"}

## Cuadro de control {.sidebar}

```{r}
monegre_data <- read.csv("data_temporal/villafranqueza_santa_faz_monegre.csv", header=TRUE, sep="\t")
monegre_data <- data.frame(monegre_data)
monegre_data[is.na(monegre_data)] <- 0.0
monegre_data$Mes = as.POSIXct(monegre_data$Mes, format = "%Y-%m-%d", tz="UTC")

# Shiny
checkboxGroupInput(
  inputId = "checkGroup_m", 
  label = h3("Selecciona la columna"), 
  choiceNames = list("Precio [m2]", "Variación Mensual", "Variación Trimestral", "Variación Anual"),
  choiceValues = names(monegre_data)[-1],
  selected = c("Precio.m2")
)
```
Column {.tabset .tabset-fade}
---
### **Evolución Temporal**
```{r}
# crear archivo xts
stat_xts_m <- xts(monegre_data, order.by=monegre_data$Mes)

renderDygraph({
  stat_xts_m <- stat_xts_m[, c("Mes", input$checkGroup_m)]
  
  graph_m <- dygraph(stat_xts_m) %>%
    dyLegend(show = "onmouseover", labelsSeparateLines = TRUE) %>%
    dyAxis("x", valueRange = c("01/01/2008", "01/12/2023"), label = "Año", drawGrid = TRUE) %>%
    dyAxis("y", label = "Precio por metro cuadrado [m2]") %>%
    dyAxis("y2", label = "Variación porcentual [%]", independentTicks = c(TRUE, TRUE), valueRange = c(-21, 23.5)) %>%
    dyRangeSelector(dateWindow = c("2009-06-01", "2023-12-01")) %>%
    dyHighlight(highlightCircleSize = 5,
                highlightSeriesOpts = list(strokeWidth = 1.5),
                highlightSeriesBackgroundAlpha = 0.2,
                hideOnMouseOut = TRUE) %>%
    {
      if(length(str_subset(input$checkGroup_m, 'Precio.m2$')) > 0 )
        dySeries(., "Precio.m2", label = "Precio [m2]")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_m, 'Variación.mensual$')) > 0 )
        dySeries(., "Variación.mensual", axis = 'y2', label = "Variación Mensual")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_m, 'Variación.trimestral$')) > 0 )
        dySeries(., "Variación.trimestral", axis = 'y2', label = "Variación Trimestral")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_m, 'Variación.anual$')) > 0 )
        dySeries(., "Variación.anual", axis = 'y2', label = "Variación Anual")
      else
        .
    }
})
```

### **Predicción con Modeltime**
esto es una prueba

Column {data-width=250}
---
### **Datos de la Tabla**
```{r}
reactable(monegre_data, 
          filterable = TRUE,
          columns = list(
              Mes = colDef(name = "Fecha", format = colFormat(date = TRUE, locales = "pt-BR")),
              Precio.m2 = colDef(name = "Precio\n [m2]"),
              Variación.mensual = colDef(
                name = "Variación\n Mensual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.trimestral = colDef(
                name = "Variación\n Trimestral",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.anual = colDef(
                name = "Variación\n Anual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              )
          )
)
```


# Virgen del Remedio - Juan XXIII {data-navmenu="Evolución IPV y Predicción"}

## Cuadro de control {.sidebar}

```{r}
xiii_data <- read.csv("data_temporal/virgen_del_remedio_juan_xxiii.csv", header=TRUE, sep="\t")
xiii_data <- data.frame(xiii_data)
xiii_data[is.na(xiii_data)] <- 0.0
xiii_data$Mes = as.POSIXct(xiii_data$Mes, format = "%Y-%m-%d", tz="UTC")

# Shiny
checkboxGroupInput(
  inputId = "checkGroup_x", 
  label = h3("Selecciona la columna"), 
  choiceNames = list("Precio [m2]", "Variación Mensual", "Variación Trimestral", "Variación Anual"),
  choiceValues = names(xiii_data)[-1],
  selected = c("Precio.m2")
)
```
Column {.tabset .tabset-fade}
---
### **Evolución Temporal**
```{r}
# crear archivo xts
stat_xts_x <- xts(xiii_data, order.by=xiii_data$Mes)

renderDygraph({
  stat_xts_x <- stat_xts_x[, c("Mes", input$checkGroup_x)]
  
  graph_x <- dygraph(stat_xts_x) %>%
    dyLegend(show = "onmouseover", labelsSeparateLines = TRUE) %>%
    dyAxis("x", valueRange = c("01/01/2008", "01/12/2023"), label = "Año", drawGrid = TRUE) %>%
    dyAxis("y", label = "Precio por metro cuadrado [m2]") %>%
    dyAxis("y2", label = "Variación porcentual [%]", independentTicks = c(TRUE, TRUE), valueRange = c(-33, 22)) %>%
    dyRangeSelector(dateWindow = c("2009-06-01", "2023-12-01")) %>%
    dyHighlight(highlightCircleSize = 5,
                highlightSeriesOpts = list(strokeWidth = 1.5),
                highlightSeriesBackgroundAlpha = 0.2,
                hideOnMouseOut = TRUE) %>%
    {
      if(length(str_subset(input$checkGroup_x, 'Precio.m2$')) > 0 )
        dySeries(., "Precio.m2", label = "Precio [m2]")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_x, 'Variación.mensual$')) > 0 )
        dySeries(., "Variación.mensual", axis = 'y2', label = "Variación Mensual")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_x, 'Variación.trimestral$')) > 0 )
        dySeries(., "Variación.trimestral", axis = 'y2', label = "Variación Trimestral")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup_x, 'Variación.anual$')) > 0 )
        dySeries(., "Variación.anual", axis = 'y2', label = "Variación Anual")
      else
        .
    }
})
```

### **Predicción con Modeltime**
esto es una prueba

Column {data-width=250}
---
### **Datos de la Tabla**
```{r}
reactable(xiii_data, 
          filterable = TRUE,
          columns = list(
              Mes = colDef(name = "Fecha", format = colFormat(date = TRUE, locales = "pt-BR")),
              Precio.m2 = colDef(name = "Precio\n [m2]"),
              Variación.mensual = colDef(
                name = "Variación\n Mensual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.trimestral = colDef(
                name = "Variación\n Trimestral",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.anual = colDef(
                name = "Variación\n Anual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              )
          )
)
```

<!-- ANUNCIOS DE IDEALISTA -->

# Benalua - La Florida - San Gabriel {data-navmenu="Anuncios en Idealista"}

<div class='general-container'>
```{r}
uiOutput("el")


benalua_info <- read.csv("data_hauses/benalua.csv", header=TRUE, sep="\t")
benalua_info <- data.frame(benalua_info)

n_benalua <- nrow(benalua_info)

divs_list <- list()
for (i in 1:n_benalua){
  #print(benalua_info[i,])
  image <- benalua_info[i, "thumbnail"]
  price <- benalua_info[i, "price"]
  size <- benalua_info[i, "size"]
  rooms <- benalua_info[i, "rooms"]
  bathrooms <- benalua_info[i, "bathrooms"]
  url <- benalua_info[i, "url"]
  floor <- benalua_info[i, "floor"]
  address <- benalua_info[i, "address"]
  description <- benalua_info[i, "description"]
  description <- substr(description, 1, 100)
  hasLift <- benalua_info[i, "hasLift"]
  parkingSpace <- benalua_info[i, "parkingSpace"]
  if (grepl("True", parkingSpace, fixed=TRUE)){
    pakring_description = "Garaje incluido"
  } else {
    pakring_description = ""
  }
  
  # lift
  if (hasLift == "True"){
    hasLift_desc <- "con ascensor"
  } else {
    hasLift_desc <- "sin ascensor"
  }
  
  # garage
  #json_data <- fromJSON(paste(readLines(json_file), collapse=""))
  
  p <- str_glue(
"<div class='article-container'>",
  "<div class='info-container'>",
    "<figure class='figure-center'>",
      "<img src={image} alt='No Image Found' height='150' width='210' class='multimedia-figure'>",
    "</figure>",
    "<div class='info-text'>",
      "<a href='{url}' role='heading' aria-level='2' class='item-link'>",
          "{address}",
      "</a>",
      "<div class='price-row'>",
          "<span class='item-price'>{price} € </span>",
          "<span>- {pakring_description}</span>",
      "</div>",
      "<div>",
          "<span class='item-detail'>{rooms} hab. </span>",
          "<span class='item-detail'>- {size} m² </span>",
          "<span class='item-detail'>- Planta {floor}ª {hasLift_desc}</span>",
      "</div>",
      "<div class='item-description'>",
          "<p class='ellipsis'>{description}...</p>",
      "</div>",
    "</div>",
  "</div>",
"</div>"
  )
  
  divs_list[i] <- p
}

output$el <- renderUI({
  lapply(divs_list, function(x){
    HTML(x)
  })
})
```
</div>

# Campoamor - Carolinas - Altozano {data-navmenu="Anuncios en Idealista"}

<div class='general-container'>
```{r}
uiOutput("el_c")


campoamor_info <- read.csv("data_hauses/campoamor.csv", header=TRUE, sep="\t")
campoamor_info <- data.frame(campoamor_info)

divs_list_c <- list()
for (i in 1:nrow(campoamor_info)){
  #print(benalua_info[i,])
  image_c <- campoamor_info[i, "thumbnail"]
  price_c <- campoamor_info[i, "price"]
  size_c <- campoamor_info[i, "size"]
  rooms_c <- campoamor_info[i, "rooms"]
  bathrooms_c <- campoamor_info[i, "bathrooms"]
  url_c <- campoamor_info[i, "url"]
  floor_c <- campoamor_info[i, "floor"]
  address_c <- campoamor_info[i, "address"]
  description_c <- campoamor_info[i, "description"]
  description_c <- substr(description_c, 1, 100)
  hasLift_c <- campoamor_info[i, "hasLift"]
  parkingSpace_c <- campoamor_info[i, "parkingSpace"]
  if (grepl("True", parkingSpace_c, fixed=TRUE)){
    pakring_description_c = "Garaje incluido"
  } else {
    pakring_description_c = ""
  }
  
  # lift
  if (hasLift_c == "True"){
    hasLift_desc_c <- "con ascensor"
  } else {
    hasLift_desc_c <- "sin ascensor"
  }
  
  # garage
  #json_data <- fromJSON(paste(readLines(json_file), collapse=""))
  
  p_c <- str_glue(
"<div class='article-container'>",
  "<div class='info-container'>",
    "<figure class='figure-center'>",
      "<img src={image_c} alt='No Image Found' height='150' width='210' class='multimedia-figure'>",
    "</figure>",
    "<div class='info-text'>",
      "<a href='{url_c}' role='heading' aria-level='2' class='item-link'>",
          "{address_c}",
      "</a>",
      "<div class='price-row'>",
          "<span class='item-price'>{price_c} € </span>",
          "<span>- {pakring_description_c}</span>",
      "</div>",
      "<div>",
          "<span class='item-detail'>{rooms_c} hab. </span>",
          "<span class='item-detail'>- {size_c} m² </span>",
          "<span class='item-detail'>- Planta {floor_c}ª {hasLift_desc_c}</span>",
      "</div>",
      "<div class='item-description'>",
          "<p class='ellipsis'>{description_c}...</p>",
      "</div>",
    "</div>",
  "</div>",
"</div>"
  )
  
  divs_list_c[i] <- p_c
}

output$el_c <- renderUI({
  lapply(divs_list_c, function(x){
    HTML(x)
  })
})
```
</div>

# Zona Centro {data-navmenu="Anuncios en Idealista"}

<div class='general-container'>
```{r}
uiOutput("el_c2")


centro_info <- read.csv("data_hauses/centro.csv", header=TRUE, sep="\t")
centro_info <- data.frame(centro_info)

divs_list_c2 <- list()
for (i in 1:nrow(centro_info)){
  #print(benalua_info[i,])
  image_c2 <- centro_info[i, "thumbnail"]
  price_c2 <- centro_info[i, "price"]
  size_c2 <- centro_info[i, "size"]
  rooms_c2 <- centro_info[i, "rooms"]
  bathrooms_c2 <- centro_info[i, "bathrooms"]
  url_c2 <- centro_info[i, "url"]
  floor_c2 <- centro_info[i, "floor"]
  address_c2 <- centro_info[i, "address"]
  description_c2 <- centro_info[i, "description"]
  description_c2 <- substr(description_c2, 1, 100)
  hasLift_c2 <- centro_info[i, "hasLift"]
  parkingSpace_c2 <- centro_info[i, "parkingSpace"]
  if (grepl("True", parkingSpace_c2, fixed=TRUE)){
    pakring_description_c2 = "Garaje incluido"
  } else {
    pakring_description_c2 = ""
  }
  
  # lift
  if (hasLift_c2 == "True"){
    hasLift_desc_c2 <- "con ascensor"
  } else {
    hasLift_desc_c2 <- "sin ascensor"
  }
  
  # garage
  #json_data <- fromJSON(paste(readLines(json_file), collapse=""))
  
  p_c2 <- str_glue(
"<div class='article-container'>",
  "<div class='info-container'>",
    "<figure class='figure-center'>",
      "<img src={image_c2} alt='No Image Found' height='150' width='210' class='multimedia-figure'>",
    "</figure>",
    "<div class='info-text'>",
      "<a href='{url_c2}' role='heading' aria-level='2' class='item-link'>",
          "{address_c2}",
      "</a>",
      "<div class='price-row'>",
          "<span class='item-price'>{price_c2} € </span>",
          "<span>- {pakring_description_c2}</span>",
      "</div>",
      "<div>",
          "<span class='item-detail'>{rooms_c2} hab. </span>",
          "<span class='item-detail'>- {size_c2} m² </span>",
          "<span class='item-detail'>- Planta {floor_c2}ª {hasLift_desc_c2}</span>",
      "</div>",
      "<div class='item-description'>",
          "<p class='ellipsis'>{description_c2}...</p>",
      "</div>",
    "</div>",
  "</div>",
"</div>"
  )
  
  divs_list_c2[i] <- p_c2
}

output$el_c2 <- renderUI({
  lapply(divs_list_c2, function(x){
    HTML(x)
  })
})
```
</div>

# Los Ángeles - Tombola - San Nicolás {data-navmenu="Anuncios en Idealista"}

# Parque Avenidas - Vistahermosa {data-navmenu="Anuncios en Idealista"}

<div class='general-container'>
```{r}
uiOutput("el_v")


vistahermosa_info <- read.csv("data_hauses/vistahermosa.csv", header=TRUE, sep="\t")
vistahermosa_info <- data.frame(vistahermosa_info)

divs_list_v <- list()
for (i in 1:nrow(vistahermosa_info)){
  #print(benalua_info[i,])
  image_v <- vistahermosa_info[i, "thumbnail"]
  price_v <- vistahermosa_info[i, "price"]
  size_v <- vistahermosa_info[i, "size"]
  rooms_v <- vistahermosa_info[i, "rooms"]
  bathrooms_v <- vistahermosa_info[i, "bathrooms"]
  url_v <- vistahermosa_info[i, "url"]
  floor_v <- vistahermosa_info[i, "floor"]
  address_v <- vistahermosa_info[i, "address"]
  description_v <- vistahermosa_info[i, "description"]
  description_v <- substr(description_v, 1, 100)
  hasLift_v <- vistahermosa_info[i, "hasLift"]
  parkingSpace_v <- vistahermosa_info[i, "parkingSpace"]
  if (grepl("True", parkingSpace_v, fixed=TRUE)){
    pakring_description_v = "Garaje incluido"
  } else {
    pakring_description_v = ""
  }
  
  # lift
  if (hasLift_v == "True"){
    hasLift_desc_v <- "con ascensor"
  } else {
    hasLift_desc_v <- "sin ascensor"
  }
  
  p_v <- str_glue(
"<div class='article-container'>",
  "<div class='info-container'>",
    "<figure class='figure-center'>",
      "<img src={image_v} alt='No Image Found' height='150' width='210' class='multimedia-figure'>",
    "</figure>",
    "<div class='info-text'>",
      "<a href='{url_v}' role='heading' aria-level='2' class='item-link'>",
          "{address_v}",
      "</a>",
      "<div class='price-row'>",
          "<span class='item-price'>{price_v} € </span>",
          "<span>- {pakring_description_v}</span>",
      "</div>",
      "<div>",
          "<span class='item-detail'>{rooms_v} hab. </span>",
          "<span class='item-detail'>- {size_v} m² </span>",
          "<span class='item-detail'>- Planta {floor_v}ª {hasLift_desc_v}</span>",
      "</div>",
      "<div class='item-description'>",
          "<p class='ellipsis'>{description_v}...</p>",
      "</div>",
    "</div>",
  "</div>",
"</div>"
  )
  
  divs_list_v[i] <- p_v
}

output$el_v <- renderUI({
  lapply(divs_list_v, function(x){
    HTML(x)
  })
})
```
</div>

# Pla del Bon Repos - La Goleta - San Anton {data-navmenu="Anuncios en Idealista"}

# Playa de San Juan - El Cabo {data-navmenu="Anuncios en Idealista"}

<div class='general-container'>
```{r}
uiOutput("el_s")


sanjuan_info <- read.csv("data_hauses/sanjuan.csv", header=TRUE, sep="\t")
sanjuan_info <- data.frame(sanjuan_info)

divs_list_s <- list()
for (i in 1:nrow(sanjuan_info)){
  #print(benalua_info[i,])
  image_s <- sanjuan_info[i, "thumbnail"]
  price_s <- sanjuan_info[i, "price"]
  size_s <- sanjuan_info[i, "size"]
  rooms_s <- sanjuan_info[i, "rooms"]
  bathrooms_s <- sanjuan_info[i, "bathrooms"]
  url_s <- sanjuan_info[i, "url"]
  floor_s <- sanjuan_info[i, "floor"]
  address_s <- sanjuan_info[i, "address"]
  description_s <- sanjuan_info[i, "description"]
  description_s <- substr(description_s, 1, 100)
  hasLift_s <- sanjuan_info[i, "hasLift"]
  parkingSpace_s <- sanjuan_info[i, "parkingSpace"]
  if (grepl("True", parkingSpace_s, fixed=TRUE)){
    pakring_description_s = "Garaje incluido"
  } else {
    pakring_description_s = ""
  }
  
  # lift
  if (hasLift_s == "True"){
    hasLift_desc_s <- "con ascensor"
  } else {
    hasLift_desc_s <- "sin ascensor"
  }
  
  p_s <- str_glue(
"<div class='article-container'>",
  "<div class='info-container'>",
    "<figure class='figure-center'>",
      "<img src={image_s} alt='No Image Found' height='150' width='210' class='multimedia-figure'>",
    "</figure>",
    "<div class='info-text'>",
      "<a href='{url_s}' role='heading' aria-level='2' class='item-link'>",
          "{address_s}",
      "</a>",
      "<div class='price-row'>",
          "<span class='item-price'>{price_s} € </span>",
          "<span>- {pakring_description_s}</span>",
      "</div>",
      "<div>",
          "<span class='item-detail'>{rooms_s} hab. </span>",
          "<span class='item-detail'>- {size_s} m² </span>",
          "<span class='item-detail'>- Planta {floor_s}ª {hasLift_desc_s}</span>",
      "</div>",
      "<div class='item-description'>",
          "<p class='ellipsis'>{description_s}...</p>",
      "</div>",
    "</div>",
  "</div>",
"</div>"
  )
  
  divs_list_s[i] <- p_s
}

output$el_s <- renderUI({
  lapply(divs_list_s, function(x){
    HTML(x)
  })
})
```
</div>

# San Blas - Pau {data-navmenu="Anuncios en Idealista"}

<div class='general-container'>
```{r}
uiOutput("el_s2")


sanblas_info <- read.csv("data_hauses/sanblas.csv", header=TRUE, sep="\t")
sanblas_info <- data.frame(sanblas_info)

divs_list_s2 <- list()
for (i in 1:nrow(sanblas_info)){
  #print(benalua_info[i,])
  image_s2 <- sanblas_info[i, "thumbnail"]
  price_s2 <- sanblas_info[i, "price"]
  size_s2 <- sanblas_info[i, "size"]
  rooms_s2 <- sanblas_info[i, "rooms"]
  bathrooms_s2 <- sanblas_info[i, "bathrooms"]
  url_s2 <- sanblas_info[i, "url"]
  floor_s2 <- sanblas_info[i, "floor"]
  address_s2 <- sanblas_info[i, "address"]
  description_s2 <- sanblas_info[i, "description"]
  description_s2 <- substr(description_s2, 1, 100)
  hasLift_s2 <- sanblas_info[i, "hasLift"]
  parkingSpace_s2 <- sanblas_info[i, "parkingSpace"]
  if (grepl("True", parkingSpace_s2, fixed=TRUE)){
    pakring_description_s2 <- "Garaje incluido"
  } else {
    pakring_description_s2 <- ""
  }
  
  # lift
  if (hasLift_s2 == "True"){
    hasLift_desc_s2 <- "con ascensor"
  } else {
    hasLift_desc_s2 <- "sin ascensor"
  }
  
  p_s2 <- str_glue(
"<div class='article-container'>",
  "<div class='info-container'>",
    "<figure class='figure-center'>",
      "<img src={image_s2} alt='No Image Found' height='150' width='210' class='multimedia-figure'>",
    "</figure>",
    "<div class='info-text'>",
      "<a href='{url_s2}' role='heading' aria-level='2' class='item-link'>",
          "{address_s2}",
      "</a>",
      "<div class='price-row'>",
          "<span class='item-price'>{price_s2} € </span>",
          "<span>- {pakring_description_s2}</span>",
      "</div>",
      "<div>",
          "<span class='item-detail'>{rooms_s2} hab. </span>",
          "<span class='item-detail'>- {size_s2} m² </span>",
          "<span class='item-detail'>- Planta {floor_s2}ª {hasLift_desc_s}</span>",
      "</div>",
      "<div class='item-description'>",
          "<p class='ellipsis'>{description_s2}...</p>",
      "</div>",
    "</div>",
  "</div>",
"</div>"
  )
  
  divs_list_s2[i] <- p_s2
}

output$el_s2 <- renderUI({
  lapply(divs_list_s2, function(x){
    HTML(x)
  })
})
```
</div>

# Villafranqueza - Santa Faz - Monegre {data-navmenu="Anuncios en Idealista"}

# Virgen del Remedio - Juan XXIII {data-navmenu="Anuncios en Idealista"}

















