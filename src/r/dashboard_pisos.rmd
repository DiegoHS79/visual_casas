---
title: "Estado de la vivienda en Alicante"
# date: "`r Sys.Date()`"
output: 
  flexdashboard::flex_dashboard:
    # orientation vale para los encabezados de segundo nivel en adelante.
    # orientation: Columns
    vertical_layout: fill

runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(reactable)
library(tidyverse)
library(latex2exp)
library(dygraphs)
library(ggplot2)
library(xts)
library(roperators)
```

# Pestaña 1

```{r}

```

# Benalua {data-navmenu="Evolución Por Barrios"}

## Cuadro de control {.sidebar}

```{r}
benalua_data <- read.csv("data_temporal/benalua_la_florida_babel_san_gabriel.csv", header=TRUE, sep="\t")
benalua_data <- data.frame(benalua_data)
benalua_data[is.na(benalua_data)] <- 0.0
benalua_data$Mes = as.POSIXct(benalua_data$Mes, format = "%Y-%m-%d", tz="UTC")

# Shiny
checkboxGroupInput(
  inputId = "checkGroup", 
  label = h3("Selecciona la columna"), 
  #choices = list("Precio [m2]" = 1, 
  #               "Variación Mensual" = 2,
  #               "Variación Trimestral" = 3,
  #               "Variación Anual" = 4),
  choices = names(benalua_data)[-1],
  selected = c("Precio.m2")
)
```
Column {.tabset .tabset-fade}
---
### **Evolución Temporal**
```{r}
#precio_m2 <- benalua_data %>% select(Mes, Precio.m2)
#mensual <- benalua_data %>% select(Mes, Variación.mensual)
#trimestral <- benalua_data %>% select(Mes, Variación.trimestral)
#anual <- benalua_data %>% select(Mes, Variación.anual)


# crear archivo xts
#xts_object <- xts(x = precio_m2, order.by = precio_m2$Mes)
#xts_object2 <- xts(x = mensual, order.by = mensual$Mes)
#xts_object3 <- xts(x = trimestral, order.by = trimestral$Mes)
#xts_object4 <- xts(x = anual, order.by = anual$Mes)

stat_xts <- xts(benalua_data, order.by=benalua_data$Mes)

#all_data <- cbind(xts_object, xts_object2, xts_object3, xts_object4)
renderDygraph({
  #req(input$checkGroup)
  
  stat_xts <- stat_xts[, c("Mes", input$checkGroup)]
  
  graph <- dygraph(stat_xts) %>%
    dyLegend(show = "onmouseover", labelsSeparateLines = TRUE) %>%
    dyAxis("x", valueRange = c("01/01/2008", "01/12/2023"), label = "Año", drawGrid = TRUE) %>%
    dyAxis("y", label = "Precio por metro cuadrado [m2]") %>%
    dyAxis("y2", label = "Variación porcentual [%]", independentTicks = c(TRUE, TRUE), valueRange = c(-17, 22)) %>%
    dyRangeSelector(dateWindow = c("2009-06-01", "2023-12-01")) %>%
    dyHighlight(highlightCircleSize = 5,
                highlightSeriesOpts = list(strokeWidth = 1.5),
                highlightSeriesBackgroundAlpha = 0.2,
                hideOnMouseOut = TRUE)
  #dygraph(all_data) %>%
    #dySeries("Precio.m2", label = "Precio [m2]") %>%
    #dySeries(graph, input$checkGroup, axis = 'y2')
    #dySeries("Variación.mensual", axis = 'y2', label = "Variación Mensual") %>%
    #dySeries("Variación.trimestral", axis = 'y2', label = "Variación Trimestral") %>%
    #dySeries("Variación.anual", axis = 'y2', label = "Variación Anual") %>%
  
  #if ("Precio.m2" %in% input$checkGroup){
  #  dySeries(graph, "Precio.m2", label = "Precio [m2]")
  #}
  #if ("Variación.mensual" %in% input$checkGroup){
  #  dySeries(graph, "Variación.mensual", axis = 'y2', label = "Variación Mensual")
  #}
  #if ("Variación.trimestral" %in% input$checkGroup){
  #  dySeries(graph, "Variación.trimestral", axis = 'y2', label = "Variación Trimestral")
  #}
  #if ("Variación.anual" %in% input$checkGroup){
  #  dySeries(graph, "Variación.anual", axis = 'y2', label = "Variación Anual")
  #}
    
})
```

### **Análisis Estadístico **
esto es una prueba

### **Predicción**
esto es una prueba

Column {data-width=320}
---
### **Datos de la Tabla**
```{r}
reactable(benalua_data, 
          filterable = TRUE,
          columns = list(
              Mes = colDef(name = "Fecha", format = colFormat(date = TRUE, locales = "pt-BR")),
              Precio.m2 = colDef(name = "Precio\n [m2]"),
              Variación.mensual = colDef(
                name = "Variación\n Mensual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.trimestral = colDef(
                name = "Variación\n Trimestral",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.anual = colDef(
                name = "Variación\n Anual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              )
          )
)
```


# Campoamor-Carolinas-Altozano {data-navmenu="Evolución Por Barrios"}

# Zona Centro {data-navmenu="Evolución Por Barrios"}

# Los Ángeles-Tombola-San Nicolás {data-navmenu="Evolución Por Barrios"}

# Parque Avenidas-Vistahermosa {data-navmenu="Evolución Por Barrios"}

# Pla del Bon Repos-La Goleta-San Anton {data-navmenu="Evolución Por Barrios"}

# Playa de San Juan-El Cabo {data-navmenu="Evolución Por Barrios"}

# San Blas-Pau {data-navmenu="Evolución Por Barrios"}

# Villafranqueza-Santa Faz-Monegre {data-navmenu="Evolución Por Barrios"}

# Virgen del Remedio-Juan XXIII {data-navmenu="Evolución Por Barrios"}





















