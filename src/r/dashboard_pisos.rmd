---
title: "Estado de la vivienda en Alicante"
# date: "`r Sys.Date()`"
output: 
  flexdashboard::flex_dashboard:
    # orientation vale para los encabezados de segundo nivel en adelante.
    # orientation: Columns
    vertical_layout: fill

runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(reactable)
library(tidyverse)
library(latex2exp)
library(dygraphs)
library(ggplot2)
library(xts)
library(stringr)
```

# Pestaña 1

```{r}

```

# Benalua {data-navmenu="Evolución Por Barrios"}

## Cuadro de control {.sidebar}

```{r}
benalua_data <- read.csv("data_temporal/benalua_la_florida_babel_san_gabriel.csv", header=TRUE, sep="\t")
benalua_data <- data.frame(benalua_data)
benalua_data[is.na(benalua_data)] <- 0.0
benalua_data$Mes = as.POSIXct(benalua_data$Mes, format = "%Y-%m-%d", tz="UTC")

# Shiny
checkboxGroupInput(
  inputId = "checkGroup", 
  label = h3("Selecciona la columna"), 
  choiceNames = list("Precio [m2]", "Variación Mensual", "Variación Trimestral", "Variación Anual"),
  choiceValues = names(benalua_data)[-1],
  selected = c("Precio.m2")
)
```
Column {.tabset .tabset-fade}
---
### **Evolución Temporal**
```{r}
# crear archivo xts
stat_xts <- xts(benalua_data, order.by=benalua_data$Mes)

renderDygraph({
  stat_xts <- stat_xts[, c("Mes", input$checkGroup)]
  
  graph <- dygraph(stat_xts) %>%
    dyLegend(show = "onmouseover", labelsSeparateLines = TRUE) %>%
    dyAxis("x", valueRange = c("01/01/2008", "01/12/2023"), label = "Año", drawGrid = TRUE) %>%
    dyAxis("y", label = "Precio por metro cuadrado [m2]") %>%
    dyAxis("y2", label = "Variación porcentual [%]", independentTicks = c(TRUE, TRUE), valueRange = c(-17, 22)) %>%
    dyRangeSelector(dateWindow = c("2009-06-01", "2023-12-01")) %>%
    dyHighlight(highlightCircleSize = 5,
                highlightSeriesOpts = list(strokeWidth = 1.5),
                highlightSeriesBackgroundAlpha = 0.2,
                hideOnMouseOut = TRUE) %>%
    {
      if(length(str_subset(input$checkGroup, 'Precio.m2$')) > 0 )
        dySeries(., "Precio.m2", label = "Precio [m2]")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup, 'Variación.mensual$')) > 0 )
        dySeries(., "Variación.mensual", axis = 'y2', label = "Variación Mensual")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup, 'Variación.trimestral$')) > 0 )
        dySeries(., "Variación.trimestral", axis = 'y2', label = "Variación Trimestral")
      else
        .
    } %>% 
    {
      if(length(str_subset(input$checkGroup, 'Variación.anual$')) > 0 )
        dySeries(., "Variación.anual", axis = 'y2', label = "Variación Anual")
      else
        .
    }
})
```

### **Análisis Estadístico **
esto es una prueba

### **Predicción**
esto es una prueba

Column {data-width=250}
---
### **Datos de la Tabla**
```{r}
reactable(benalua_data, 
          filterable = TRUE,
          columns = list(
              Mes = colDef(name = "Fecha", format = colFormat(date = TRUE, locales = "pt-BR")),
              Precio.m2 = colDef(name = "Precio\n [m2]"),
              Variación.mensual = colDef(
                name = "Variación\n Mensual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.trimestral = colDef(
                name = "Variación\n Trimestral",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              ),
              Variación.anual = colDef(
                name = "Variación\n Anual",
                style = function(value) {
                  if (value > 0) {
                    color <- "#008000"
                  } else if (value < 0) {
                    color <- "#e00000"
                  } else {
                    color <- "#777"
                  }
                  list(color = color)
                  }
              )
          )
)
```


# Campoamor-Carolinas-Altozano {data-navmenu="Evolución Por Barrios"}

# Zona Centro {data-navmenu="Evolución Por Barrios"}

# Los Ángeles-Tombola-San Nicolás {data-navmenu="Evolución Por Barrios"}

# Parque Avenidas-Vistahermosa {data-navmenu="Evolución Por Barrios"}

# Pla del Bon Repos-La Goleta-San Anton {data-navmenu="Evolución Por Barrios"}

# Playa de San Juan-El Cabo {data-navmenu="Evolución Por Barrios"}

# San Blas-Pau {data-navmenu="Evolución Por Barrios"}

# Villafranqueza-Santa Faz-Monegre {data-navmenu="Evolución Por Barrios"}

# Virgen del Remedio-Juan XXIII {data-navmenu="Evolución Por Barrios"}





















